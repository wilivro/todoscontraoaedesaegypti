define(function(require){function _setConfig(config){_configEDI=config}function _init(linhas,colunas,palavras,frase,callBack){function mostrarPalavra(palavra){for(i=0;i<palavra.pontos.length;i++)addFilter($('div[x="'+palavra.pontos[i].x+'"]'),palavra.pontos[i].y);$('div[palavra="'+palavra.palavra+'"]').fadeTo(300,.01,function(){$(this).html(palavra.palavra).css("color","#7ea6d7").fadeTo(300,1)}),edi.objetivos.unshift(1),peca.objetivos.pop(),edi.objetivos.pop(),edi.finalizar(),callBack&&0===peca.objetivos.length&&callBack()}edi.iniciar(_configEDI);var i,j,deuCerto,tentativa,auxLinha,auxColuna,o,aux,peca=this,objPalavras=[],tentaNovamente=!1,linha=[],addClique=function(_this){_this.click(function(){for(z=0;z<objPalavras.length;z++)for(x=0;x<objPalavras[z].pontos.length;x++)objPalavras[z].pontos[x].x==$(this).attr("x")&&objPalavras[z].pontos[x].y==$(this).attr("y")&&mostrarPalavra(objPalavras[z])})},addFilter=function(_this,posy){_this.filter('[y="'+posy+'"]').fadeOut(300,function(){$(this).css("color","#f8e13a").fadeIn().off()}).off()};palavras.forEach(function(data){edi.objetivos.push(0),peca.objetivos.push(0)});do{for(objPalavras=[],tentaNovamente=!1,linha=[],i=0;linhas>i;i++)for(linha[i]={},linha[i].coluna=[],j=0;colunas>j;j++)linha[i].coluna[j]="*";var qtdVerticais=(Math.floor(palavras.length/2)+Math.floor(palavras.length%2),Math.floor(palavras.length/2));for(i=0;qtdVerticais>i;i++)for(deuCerto=!1,tentativa=0;!deuCerto&&100>=tentativa;){for(auxLinha=0,auxColuna=0,auxLinha=Math.floor(Math.random()*(linhas-palavras[i].length+1)),auxColuna=Math.floor(Math.random()*colunas),auxLinha2=auxLinha,j=0;j<palavras[i].length;j++){if("*"!=linha[auxLinha].coluna[auxColuna]&&linha[auxLinha].coluna[auxColuna]!=palavras[i].charAt(j)){deuCerto=!1;break}j+1==palavras[i].length&&(deuCerto=!0),auxLinha++}if(deuCerto){for(o={palavra:palavras[i],pontos:[]},j=0;j<palavras[i].length;j++)o.pontos.push({x:auxColuna,y:auxLinha2}),linha[auxLinha2].coluna[auxColuna]=palavras[i].charAt(j),auxLinha2++;objPalavras.push(o)}tentativa++}for(i=qtdVerticais;i<palavras.length;i++)for(deuCerto=!1,tentativa=0;!deuCerto&&100>=tentativa;){if(tentativa>90){console.log(tentativa),tentaNovamente=!0;break}for(auxLinha=0,auxColuna=0,auxLinha=Math.floor(Math.random()*linhas),auxColuna=Math.floor(Math.random()*(colunas-palavras[i].length+1)),auxColuna2=auxColuna,j=0;j<palavras[i].length;j++){if("*"!=linha[auxLinha].coluna[auxColuna]&&linha[auxLinha].coluna[auxColuna]!=palavras[i].charAt(j)){deuCerto=!1;break}j+1==palavras[i].length&&(deuCerto=!0),auxColuna++}if(deuCerto){for(o={palavra:palavras[i],pontos:[]},j=0;j<palavras[i].length;j++)o.pontos.push({x:auxColuna2,y:auxLinha}),linha[auxLinha].coluna[auxColuna2]=palavras[i].charAt(j),auxColuna2++;objPalavras.push(o)}tentativa++}}while(tentaNovamente);var altura=300,largura=400;for(i=0;i<objPalavras.length;i++){for(aux="",j=0;j<objPalavras[i].palavra.length;j++)aux+="_";frase=frase.replace("{"+i+"}",'<div class="palavras palavra'+i+'" style="display:inline-block;" banco_id=\''+i+"' palavra='"+objPalavras[i].palavra+"'>"+aux+"</div>")}var frase_div=$("<div>").css("width",670-largura-colunas+"px").css("height",altura+"px").css("position","absolute").css("text-align","center").css("color","#666").css("top","100px").css("left","30px").css("font-size","15px").addClass("box2 centraliza-vertical texto").appendTo($("#conteudo")),frase_div2=$("<div>").addClass("centraliza-vertical2").appendTo(frase_div),caca_palavras_div=($("<div>").attr({id:"frase"}).addClass("centraliza-vertical3").html(frase).appendTo(frase_div2),$("<div>").css("width",largura+colunas+"px").css("height",altura+"px").css("position","absolute").css("top","68px").css("right","30px").css("background-color","#7ea6d7").css("color","#fff").css("padding","7px 0 7px 15px").addClass("caca-palavras").addClass("box2").addClass("borda-cinza").addClass("arredondado").appendTo($("#conteudo")));for(i=0;linhas>i;i++)for(aux="",j=0;colunas>j;j++){var dv=$("<div>").html("*"!=linha[i].coluna[j]?linha[i].coluna[j]:String.fromCharCode(65+Math.floor(26*Math.random()))).css("width",largura/colunas+"px").css("height",altura/linhas+"px").css("text-transform","uppercase").css("display","inline-block").css("cursor","pointer").css("text-align","center").attr("x",j).attr("y",i).appendTo(caca_palavras_div);addClique(dv),aux+=linha[i].coluna[j]+" "}ARR_TAREFAS[tarefaRevela].resolve()}var tarefaRevela=addTarefa(),edi=require("./edi"),_configEDI=null;return{objetivos:[],setConfig:_setConfig,caca_palavras:_init}});