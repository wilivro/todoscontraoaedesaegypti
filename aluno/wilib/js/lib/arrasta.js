define(function(require){function _setConfig(config){_configEDI=config}function _init(classGroupArrasta,classGroupSolta,callBack,callBackFinal,settings,callBackEndLoading,callBackDrag,callBackStop){function appendArrasta(obj,parent){if(config.clone){var $clone=obj.clone();$clone.addClass("arrasta").css({cursor:"pointer",left:$clone.attr("data-x")+"px",top:$clone.attr("data-y")+"px"}).appendTo("#principal").draggable({revert:!0})}if(config.centraliza&&(obj.css({top:config.reloadCorreta?0:obj.css("top"),left:config.reloadCorreta?0:obj.css("left"),position:config.position,display:"table-cell",verticalAlign:"middle",height:config.reloadCorreta?"auto":obj.css("height")}).removeClass("azulAlpha").draggable({revert:!1}),$(parent).css({textAlign:"center"})),!config.destroy){var dv_rel=$("<span>").css({width:"100%",height:"100%",display:config.displaySpan,position:config.position}).addClass("add").append(obj.css({margin:config.reloadCorreta?0:obj.css("margin"),padding:config.reloadCorreta?0:obj.css("padding")}));config.colorirFilho&&dv_rel.children().css("color",config.corTexto),$(parent).css("display","inline-block").append(dv_rel),config.multAlvo||$(parent).droppable("destroy")}}var peca=this;edi.iniciar(_configEDI);var condicao=!0,config={zIndexDefault:!0,alvoFixo:!1,corTexto:"#9c0",gradiente:"corGradiente",centraliza:!0,append:!0,destroy:!1,colorirFilho:!1,animacaoFundoArrasta:!1,reloadCorreta:!1,multAlvo:!1,clone:!1,target:!0,position:"relative",displaySpan:"table",tempoMultitela:0,cb:null};settings&&$.extend(config,settings),config.animacaoFundoArrasta&&$("."+classGroupArrasta).each(function(index,el){$(this).addClass(config.gradiente)}),$("."+classGroupArrasta).draggable({revert:"invalid"}).css("cursor","pointer"),$("."+classGroupArrasta).draggable({drag:function(event,ui){callBackDrag&&callBackDrag($(this)),config.zIndexDefault&&$(this).css("z-index","20")},stop:function(event,ui){callBackStop&&callBackStop($(this)),config.zIndexDefault&&$(this).css("z-index","0")}}).on("dragstart",function(event,ui){scaleFactor=getScale(),$("#droppable_area_ids").html(""),click.x=event.clientX,click.y=event.clientY}).on("drag",function(event,ui){var zoom=getScale(),original=ui.originalPosition;ui.position={left:(event.clientX-click.x+original.left)/zoom,top:(event.clientY-click.y+original.top)/zoom}}).on("dragend",function(event,ui){click.x=0,click.y=0}),$.each($("."+classGroupSolta),function(key,alvo){var corretaArrasta="."+classGroupArrasta+"[data-correta='"+$(this).attr("data-correta")+"']";if(!config.multAlvo&&$(corretaArrasta).length&&(edi.objetivos.push(0),peca.objetivos.push(0)),config.multAlvo)for(i=0;i<$(corretaArrasta).length;i++)edi.objetivos.push(0),peca.objetivos.push(0)});var arrastasTop=[],arrastasLeft=[];$("."+classGroupArrasta).each(function(a,b){var $arrasta=$(this);arrastasTop[a]=$arrasta.offset().top-$("#principal").offset().top,arrastasLeft[a]=$arrasta.offset().left-$("#principal").offset().left}),$("."+classGroupArrasta).each(function(a){var $arrasta=$(this);$arrasta.attr({"data-Y":Math.ceil(arrastasTop[a]),"data-X":Math.ceil(arrastasLeft[a]),"data-id":$arrasta.attr("data-id")?$arrasta.attr("data-id"):a})}),$("."+classGroupArrasta).each(function(a){var $arrasta=$(this);$arrasta.css({position:"absolute",top:arrastasTop[a],left:arrastasLeft[a]}).appendTo("#principal")});var styleAlvo,acertou;if($("."+classGroupSolta).droppable({accept:"."+classGroupArrasta,tolerance:"pointer",over:function(a,ui){acertou=$(this).attr("data-correta")==$(ui.draggable).attr("data-correta"),config.target&&(styleAlvo=this.style.boxShadow,$(this).css({boxShadow:"inset 0 5px 30px -10px rgba(0,0,0,0.51)"}))},out:function(a,ui){config.target&&(this.style.boxShadow=styleAlvo)},drop:function(a,ui){config.target&&(this.style.boxShadow=styleAlvo);$(this).attr("data-correta"),$(ui.draggable).attr("data-correta");if($(this).attr("data-correta")&&$(ui.draggable).attr("data-correta"))if(acertou||!config.alvoFixo){acertou&&edi.acertos.push($(ui.draggable).attr("data-id"));var parent=this;appendArrasta(ui.draggable,parent),config.centraliza&&(ui.draggable.css({position:config.position,display:"table-cell",left:0,top:0}),$(this).css({textAlign:"center"})),config.append||config.colorirFilho&&ui.draggable.css("color",config.corTexto),ui.draggable.draggable("destroy").css("cursor","default").css("z-index","0").removeClass(config.gradiente),config.destroy&&$(ui.draggable).remove(),edi.objetivos.pop(),edi.objetivos.unshift(acertou?1:2),peca.objetivos.pop(),!peca.objetivos.length&&edi.objetivos.indexOf(2)>=0&&(edi.objetivos=[2]),0===peca.objetivos.length&&callBackFinal&&callBackFinal(edi.objetivos.indexOf(2)<0?!0:!1)}else acertou||$(ui.draggable).animate({left:$(ui.draggable).attr("data-X"),top:$(ui.draggable).attr("data-Y")}).css("z-index","0");callBack&&callBack(acertou,$(ui.draggable),$(this)),licao.config.WIQUADRO&&Wiquadro.api.addInteration(2,$(ui.draggable).attr("id"),$(this).attr("id"),acertou),condicao&&edi.finalizar({tempoMultitela:config.tempoMultitela},null,function(){condicao=!1})}}),config.reloadCorreta){var temp=edi.util.getURL("acertos");if(null!==temp)for(var acertos=temp.split(","),i=0;i<acertos.length;i++)if(""!==acertos[i]){var self=$('[data-id="'+acertos[i]+'"]');self.css({cursor:"default"}).unbind(),config.multAlvo?appendArrasta(self,$(".alvo[data-correta='"+self.attr("data-correta")+"']").first()):(appendArrasta(self,$(".alvo[data-correta='"+self.attr("data-correta")+"']").first()),$(".alvo[data-correta='"+self.attr("data-correta")+"']").first().removeAttr("data-correta")),edi.acertos.push(self.attr("data-id")),peca.objetivos.pop(),edi.objetivos.pop(),edi.objetivos.unshift(1)}}callBackEndLoading&&callBackEndLoading(),ARR_TAREFAS[tarefaArrasta].resolve(config.cb)}var click={x:0,y:0},tarefaArrasta=addTarefa(),edi=require("../lib/edi"),_configEDI=null;return{objetivos:[],setConfig:_setConfig,arrasta:_init,util:edi.util,telaAtual:edi.util.getURL("quest"),root:edi}});