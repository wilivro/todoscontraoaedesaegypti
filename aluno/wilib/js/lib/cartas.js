define(function(require){function _setConfig(config){_configEDI=config}function _init(cartas,callBack,callBackFinal,settings){function ordenar(){$("#carta"+cont).transition({x:config.distanciaCartasFinal*cont+config.distanciaCartasInicial,y:20*cont+50},500,function(){cont++,ordenar()})}edi.iniciar(_configEDI);var peca=this,condicao=!0,cont=0,config={width:86,height:127,distanciaCartasInicial:100,distanciaCartasFinal:60,fontSize:10,color:"#8CA8B8",aleatorio:!0};settings&&$.extend(config,settings),config.aleatorio&&cartas.sort(function(){return.5-Math.random()});for(var ctAll=$("<section>").css({position:"absolute",top:20,left:10}).attr("data-edi","edi-cartas").appendTo("#conteudo"),finalizar=function(){edi.objetivos.pop(),peca.objetivos.pop(),edi.objetivos.unshift(1),edi.finalizar(),callBack&&callBack(),0===peca.objetivos.length&&callBackFinal&&(cont=0,callBackFinal(),ordenar())},addClique=function(_this){_this.click(function(){if(condicao){condicao=!1;var _this=$(this);_this.off(),_this.transition({rotateY:"90deg"},500,function(){_this.find(".carta").remove(),_this.transition({rotateY:"0deg"},600,function(){finalizar(),condicao=!0})})}})},i=0;i<cartas.length;i++){edi.objetivos.push(0),peca.objetivos.push(0);var ctFirst=$("<div>").css({display:"inline-block",textAlign:"center",width:config.width+20,height:config.height+35,background:"#FFF",border:"double 3px #8CA8B8"}),ctSecond=$("<div>").css({display:"table-cell",textAlign:"center",position:"relative",background:"#FFF",verticalAlign:"middle",padding:10,border:"solid 1px #8CA8B8",borderRadius:10,cursor:"pointer"}).transition({rotateY:"180deg"}).append(ctFirst);addClique(ctSecond);var ctThird=$("<div>").attr("id","carta"+i).append(ctSecond).appendTo(ctAll);ctThird.css({position:"absolute",scale:.1,top:0,left:-90});var circulo=($("<img>").addClass("carta").attr({src:"../wilib/img/svg/fundoCarta.svg",width:ctThird.width(),height:ctThird.height()-5}).css({backgroundSize:"100% 100%",position:"absolute",top:-1,left:-1}).transition({rotateY:"180deg"}).appendTo(ctSecond),$("<img>").css({display:"inline-block",textAlign:"center",border:"solid 1px #8CA8B8",borderRadius:10,marginTop:5}).attr({position:"relative",width:config.width,height:config.height,src:cartas[i].img}).appendTo(ctFirst),$("<span>").css({display:"inline-block",textAlign:"center",fontSize:config.fontSize,color:config.color,fontWeight:"bold",margin:0}).html(cartas[i].texto).appendTo(ctFirst),$("<div>").css({position:"absolute",width:30,height:30,borderRadius:50,backgroundColor:"#FFF",top:4,left:4,border:"solid 1px #8CA8B8"}).appendTo(ctFirst));$("<div>").css({position:"realtive",verticalAlign:"middle",display:"table-cell",color:"#8CA8B8",fontWeight:"bold",fontSize:22,width:circulo.width(),height:circulo.height()}).html(i+1).appendTo(circulo)}!function destribuirCartas(){$("#carta"+cont).transition({x:140*cont+config.distanciaCartasInicial,y:100,scale:1},100,function(){cont++,destribuirCartas()})}(),ARR_TAREFAS[tarefaCartas].resolve()}var tarefaCartas=addTarefa(),edi=require("../lib/edi"),_configEDI=null;return{objetivos:[],setConfig:_setConfig,cartas:_init}});