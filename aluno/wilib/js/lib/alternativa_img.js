define(function(require){function _setConfig(config){_configEDI=config}function _init(bt_img,cb,cbFinal,settings){function embaralhar(arr){for(var valorTemporaio,indexAleatorio,indexAtual=arr.length;0!==indexAtual;)indexAleatorio=Math.floor(Math.random()*indexAtual),indexAtual-=1,valorTemporaio=arr[indexAtual],arr[indexAtual]=arr[indexAleatorio],arr[indexAleatorio]=valorTemporaio;return arr}function handlerImgClick(e){e.stopPropagation();var _this=$(this);_this.css("opacity",1).off(),_this.parent().parent().find(".alter-img-texto").fadeIn(),_this.parent().find(".mini-icon").fadeIn(),peca.objetivos.length&&edi.objetivos.pop(),peca.objetivos.pop(),"true"==_this.attr("data-correta")?(edi.objetivos.unshift(1),config.btnBranco&&$(this).addClass(".btn-sem-estilo btn-sem-estilo-acertou"),config.animacao&&require(["../../canvas/objetos/animaCerto"],function(canvas){var mascote=new canvas.animaCerto({cor:"blue"});mascote.obj.css({top:11,left:8}).appendTo(_this.parent().find(".mini-icon")),mascote.play()}),cb&&cb(!0,_this)):(edi.objetivos.unshift(2),config.btnBranco&&$(this).addClass(".btn-sem-estilo btn-sem-estilo-errou"),config.animacao&&require(["../../canvas/objetos/animaErrado"],function(canvas){var mascote=new canvas.animaErrado({cor:"red"});mascote.obj.css({top:12,left:12}).appendTo(_this.parent().find(".mini-icon")),mascote.play()}),cb&&cb(!1,_this)),!peca.objetivos.length&&edi.objetivos.indexOf(2)>=0?(edi.objetivos=[2],$(".alter-img .img").off("click").off("mouseenter").off("mouseleave")):!peca.objetivos.length&&edi.objetivos.indexOf(2)<0&&(cbFinal&&cbFinal(_this),$(".alter-img .img").off("click").off("mouseenter").off("mouseleave")),edi.finalizar()}function handlerImgMouseEnter(){var _this=$(this);_this.parent().css({opacity:.7})}function handlerImgMouseLeave(){var _this=$(this);_this.parent().css({opacity:.5})}function handlerImgSomClick(e){e.stopPropagation()}edi.iniciar(_configEDI),peca=this;var objectives=0,config={width:150,left:125,top:150,colunas:3,margin:5,padding:5,display:"table",animacao:!0,miniIconTop:null,embaralhar:!1,balao:!0,topIcoCerto:9,leftIcoCerto:4,topIcoErrado:12,leftIcoErrado:12,cb:null},textoConfig={width:90,height:100,left:0,top:80,setaLeft:75,fontSize:12,lineHeight:1,pMarginTop:0,balao:{top:0,left:0,scaleX:-1,scaleY:1,background:"#FFF",borda:"#E2E2E2",tamanhoBorda:9,rotate:0}};bt_img.length%2!==0&&config.colunas%2===0&&config.colunas>1&&bt_img.push({}),settings&&$.extend(config,settings),config.embaralhar&&(bt_img=embaralhar(bt_img));for(var $alterImgMain=$("<section>").addClass("alter-img").attr("data-edi","alternativa_img").css({position:"absolute",left:config.left,top:config.top,display:config.display}).appendTo("#conteudo"),index=0,i=0;i<config.colunas;i++)if(bt_img[index])for(var $alterImgCols=$("<div>").css({width:config.width/config.colunas,height:config.height,display:"table","float":"left"}).addClass("alter-img-cols").appendTo(".alter-img"),j=0;j<bt_img.length/config.colunas;j++){$.extend(textoConfig,bt_img[index].textoConfig);var $alterImgContent=$("<div>").addClass("alter-img-content").css("margin",config.margin).appendTo($alterImgCols),$alterImgBox=$("<div>").addClass("alter-img-box");config.imgBoxCSS&&$alterImgBox.css(config.imgBoxCSS),bt_img[index].src&&$alterImgBox.appendTo($alterImgContent);var $alterImgTexto=$("<div>").css(textoConfig).addClass("alter-img-texto");bt_img[index].texto&&($alterImgTexto.appendTo($alterImgContent),$alterImgTexto.peBalao(textoConfig.balao));var $miniIcon=$("<span>").addClass("mini-icon").css("left",config.width/2-25);config.miniIconCSS&&$miniIcon.css(config.miniIconCSS),config.miniIconTop&&$miniIcon.css("top",config.miniIconTop),config.animacao&&$miniIcon.appendTo($alterImgBox);var $img=$("<img>");objectives++,bt_img[index].dataCorreta&&(edi.objetivos.push(0),this.objetivos.push(0)),bt_img[index].src&&($img.css({width:config.width,height:config.height,margin:config.margin,padding:config.padding,lineHeight:config.lineHeight,position:"relative"}).addClass("img").attr({src:bt_img[index].src,"data-correta":bt_img[index].dataCorreta,"btn-":+edi.util.getURL("quest")+index,id:+edi.util.getURL("quest")+index}).appendTo($alterImgBox).click(handlerImgClick).mouseenter(handlerImgMouseEnter).mouseleave(handlerImgMouseLeave),$("<p>").addClass("p").html(bt_img[index].texto).css({"line-height":textoConfig.lineHeight,"margin-top":textoConfig.pMarginTop}).appendTo($alterImgTexto),bt_img[index].dataSom&&$("<span>").addClass("btn-som").appendTo($alterImgBox).click(handlerImgSomClick)),index++}return ARR_TAREFAS[tarefaalternativa_img].resolve(config.cb),{container:$alterImgMain}}var tarefaalternativa_img=addTarefa(),edi=require("../lib/edi"),_configEDI=null;return{objetivos:[],setConfig:_setConfig,alternativa_img:_init}});