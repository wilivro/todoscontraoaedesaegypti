define(function(require){"use strict";function _setConfig(config){_configEDI=config}function _init(bolas,cb,opt,cbFinal){edi.iniciar(_configEDI);var bolinhas=[],objetivos=[];bolas.forEach(function(data,i){objetivos.push([]);for(var j=0;j<data.qtd;j++)objetivos[i].push(0)});var config={arrasta:{width:375,height:85,left:130,top:20,padding:"10px 40px"},alvo:{width:300,height:300,left:130,top:150},tamanhoBolas:27,margin:"7.5px 4px",animacao:!1,embaralhar:!0,mascara:!0};opt&&$.extend(config,opt);var $arrastaB=$("<section>").addClass("arrasta-bola").attr("data-edi","arrasta-bola").css({width:790,height:315,position:"absolute"}).appendTo("#conteudo"),$topo=$("<div>").addClass("arrasta-bola-topo").css({minHeight:100,position:"relative"}).appendTo($arrastaB),$topoInner=$("<div>").addClass("topo-inner").css({width:config.arrasta.width,height:config.arrasta.height,padding:config.arrasta.padding,display:"block",borderRadius:10,position:"absolute",left:config.arrasta.left,top:config.arrasta.top,background:"linear-gradient(to bottom, #fff, #eee)",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.3)"}).appendTo($topo),$alvos=$("<div>").addClass("alvos").css({position:"absolute",left:config.alvo.left,top:config.alvo.top}).appendTo($arrastaB),$alvosLateral=$("<div>").addClass("alvos-lateral").css({background:"linear-gradient(#fff, #eee)",position:"absolute",left:0,top:0,borderRadius:10,boxShadow:"0 1px 3px rgba(0, 0, 0, 0.3)"}).appendTo($alvos),$alvosAlvos=$("<div>").css({background:"linear-gradient(#fff, #eee)",position:"absolute",left:14+config.tamanhoBolas,top:5,width:config.alvo.width,borderLeft:0,borderBottomRightRadius:10,borderTopRightRadius:10,boxShadow:"0 1px 3px rgba(0, 0, 0, 0.3)"}).appendTo($alvos);bolas.forEach(function(data,i){$(data).attr("data-correta",i);for(var j=0;j<data.qtd;j++)bolinhas.push({dataCorreta:i,cor:data.cor,img:data.img});var $alvoRef=$("<div>").addClass("alvo-ref mascara").css({width:config.tamanhoBolas,height:config.tamanhoBolas,background:data.cor,borderRadius:"50%",margin:config.margin,border:"3px solid #fff",boxShadow:"0px 0px 2px rgba(0, 0, 0, 0.3)",position:"relative"}).appendTo($alvosLateral);data.img&&$alvoRef.css({background:"url("+data.img+") no-repeat center, #fff",backgroundSize:"100% 100%"});for(var $alvosAlvosInner=$("<div>").addClass("alvo-alvo-inner").css({width:config.alvo.width,display:"block","float":"left",position:"relative"}).appendTo($alvosAlvos),l=0;l<data.qtd;l++)$("<div>").addClass("alvo").attr("data-correta",i).css({width:config.tamanhoBolas+3,height:config.tamanhoBolas+3,"float":"left",border:"1px solid #ccc",margin:4,borderRadius:"50%",display:"inline-block"}).appendTo($alvosAlvosInner)}),config.embaralhar&&bolinhas.sort(function(){return.5-Math.random()}),bolinhas.forEach(function(data){$("<div>").addClass("bolinha arrasta mascara").attr({"data-correta":data.dataCorreta,"data-cor":data.cor,"data-img":data.img}).css({width:config.tamanhoBolas,height:config.tamanhoBolas,background:"linear-gradient(to bottom, #999, #666)",border:"3px solid #fff",boxShadow:"0px 0px 2px rgba(0, 0, 0, 0.3)","float":"left",borderRadius:"50%",margin:2,cursor:"pointer"}).appendTo($topoInner).mouseenter(function(){data.img?$(this).css({background:"url("+data.img+") no-repeat center, #fff",backgroundSize:"100% 100%"}):$(this).css("background",$(this).attr("data-cor"))}).mouseleave(function(){$(this).css("background","linear-gradient(to bottom, #999, #666)")})}),arrastaMod.arrasta("arrasta","alvo",function(a,b,c){if(b.css({background:b.attr("data-cor"),left:-3,top:-3}).off(),b.attr("data-img")&&b.css({background:"url("+b.attr("data-img")+") no-repeat center #fff",backgroundSize:"100% 100%"}),a&&objetivos[b.attr("data-correta")].pop(),0===objetivos[b.attr("data-correta")].length&&bolas[b.attr("data-correta")].cb(a),config.animacao&&0===objetivos[b.attr("data-correta")].length){var $animBox=$("<div>").addClass("anim").css({width:30,height:30,position:"absolute",left:config.alvo.width+20,top:5,borderRadius:5,background:"linear-gradient(#fff, #eee)",boxShadow:"0px 0px 2px rgba(0, 0, 0, 0.3)",display:"none"}).appendTo(c.parent()).fadeIn();$("<span>").css({width:20,borderTop:"1px solid rgba(0, 0, 0, 0.2)",position:"absolute",left:-20,top:14}).appendTo($animBox);var img="../../canvas/objetos/animaCerto";require([img],function(canvas){var mascote=new canvas.animaCerto({width:25,cor:"#037CC2"});mascote.obj.css({top:3,left:2}).appendTo($animBox),mascote.play()})}},function(){var a=!0;edi.objetivos.forEach(function(data){1!=data&&(a=!1)}),cb&&cb(a),cbFinal&&cbFinal(a)}),config.mascara&&$("<div>").css({width:"93%",height:"93%",position:"absolute",left:1,top:1,borderRadius:"50%",background:"linear-gradient(to bottom, rgba(225, 225, 225, 0.7), rgba(225, 225, 225, 0))"}).appendTo(".mascara"),ARR_TAREFAS[tarefaArrastaBola].resolve()}var tarefaArrastaBola=addTarefa(),arrastaMod=require("../lib/arrasta"),edi=require("../lib/edi"),_configEDI=null;return{objetivos:[],setConfig:_setConfig,arrastaBola:_init}});