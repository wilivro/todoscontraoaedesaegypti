define(function(require){"use strict";function _setConfig(config){_configEDI=config}function _init(texto,callback,settings){function canetaAnimation(){$caneta.css({left:"+="+util.getRandomInt(0,17),top:"+="+util.getRandomInt(0,17)})}function play(){$caneta.off(),$caneta.animate({left:$("#letra0").offset().left,top:$("#letra0").offset().top-config.texto.fontSize*(WINDOW_WIDTH/WIDTH_DEFAULT)-.75*$caneta.height()},1e3,function(){var index=0,loop=setInterval(function(){var $letra=$("#letra"+index).css("opacity",1).removeClass("a");null!==$letra.offset()&&$caneta.css({left:$letra.offset().left+(config.caneta.ajustePonta?config.caneta.ajustePonta.x:0),top:$letra.offset().top-config.texto.fontSize*(WINDOW_WIDTH/WIDTH_DEFAULT)-.75*$caneta.height()+(config.caneta.ajustePonta?config.caneta.ajustePonta.y:0)}),canetaAnimation(),index++,0===$(".a").length&&(clearInterval(loop),$caneta.css("z-index",-100),$caneta.animate({left:$("#posFinal").offset().left,top:$("#posFinal").offset().top+100},1e3),edi.finalizar(),callback&&callback())},config.tempo)})}edi.iniciar(_configEDI);var config={texto:{width:450,position:"absolute",left:30,top:40,fontSize:18,textAlign:"center",fontFamily:"script",color:"#919191",lineHeight:1.4,textShadow:"1px 1px 1px rgba(0, 0, 0, 0.1)"},caneta:{width:150,posInicial:{x:600,y:10},posFinal:{x:600,y:10},ponta:7,imagem:"../wilib/img/svg/caneta.svg",ajustePonta:{x:0,y:0}},tempo:60,cb:null};settings&&$.extend(config,settings);var _font;switch(config.texto.fontFamily){case"script":_font="fontScript";break;case"eraserdust":_font="fontErasdust";break;default:_font="fontScript"}for(var util={getRandomInt:function(min,max){return Math.floor(Math.random()*(max-min))+min},getOffSet:function(a){return{left:a.offset().left+a.width()/2,top:a.offset().top+a.height()/2-a.parent().height()}}},$canetaBox=$("<section>").addClass("caneta-box").attr("data-edi","caneta").css({width:790,height:315,position:"absolute"}).appendTo("#conteudo"),$texto=$("<p>").attr("id","caneta-texto").css(config.texto).appendTo($canetaBox),tmp="",tag=!1,i=0;i<=texto.length;i++)"<"==texto[i]?tag=!0:">"==texto[i]&&tag&&(tag=!1),tag?tmp+=texto[i]:">"!=texto[i]||tag||(tmp+=texto[i],$(tmp).appendTo($texto),tmp=""),tag||">"==texto[i]||$("<span>").addClass("a "+_font).attr("id","letra"+i).html(texto[i]).css({color:config.color,opacity:0}).appendTo($texto);$("<span>").attr("id","posInicial").css({position:"absolute",left:config.caneta.posInicial.x,top:config.caneta.posInicial.y}).appendTo($canetaBox),$("<span>").attr("id","posFinal").css({position:"absolute",left:config.caneta.posFinal.x,top:config.caneta.posFinal.y}).appendTo($canetaBox);var $caneta=$("<img>").attr({id:"caneta",src:config.caneta.imagem}).css({width:config.caneta.width*(WINDOW_WIDTH/WIDTH_DEFAULT),backgroundSize:"100% 100%",position:"absolute",left:$("#posInicial").offset().left,top:$("#posInicial").offset().top,cursor:"pointer"}).appendTo("body");$caneta.click(play),ARR_TAREFAS[tarefaCaneta].resolve(config.cb)}var tarefaCaneta=addTarefa(),edi=require("../lib/edi"),_configEDI=null;return{objetivos:[],setConfig:_setConfig,caneta:_init}});