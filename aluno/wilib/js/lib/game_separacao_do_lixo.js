function main(){var now=Date.now(),dt=(now-lastTime)/1e3;update(dt),render(),lastTime=now,requestAnimFrame(main)}function init(){lastTime=Date.now(),main()}function update(dt){if(gameTime+=dt,updateEntities(dt),Date.now()-ultimoLixo>2e3*_x&&!isGameOver){var random=Math.floor(12*Math.random());lixos.push({pos:[370*_x,55*_x],type:lixosPreset[random].type,sprite:lixosPreset[random].sprite}),ultimoLixo=Date.now()}checkCollisions()}function updateEntities(dt){isGameOver||cestos.forEach(function(_cesto){_cesto.pos[0]=_x*mouse.x/getScale()-5*_cesto.sprite.size[0]/2+_cesto.left}),lixos.forEach(function(lixo,i){lixo.pos[1]+=100*_x*dt,lixo.pos[1]>canvas.height&&!isGameOver&&(lixos.splice(i,1),lifes--,-1==lifes&&(gameOver(),lifeIndex=0),lifeIndex+=100,lifeSprite=new Sprite(lifeImg,[lifeIndex,0],[100*_x,100*_x],0,[0],null,null,!0))})}function collides(x,y,r,b,x2,y2,r2,b2){return!(x2>=r||x>r2||y2>=b||y>b2)}function boxCollides(pos,size,pos2,size2){return collides(pos[0],pos[1],pos[0]+size[0],pos[1]+size[1],pos2[0],pos2[1],pos2[0]+size2[0],pos2[1]+size2[1])}function checkCollisions(){checkPlayerBounds(),lixos.forEach(function(lixo,i){var pos=lixo.pos,size=lixo.sprite.size;cestos.forEach(function(_cesto){var pos2=_cesto.pos,size2=_cesto.sprite.size;boxCollides(pos,size,pos2,size2)&&lixo.type==_cesto.type&&!isGameOver&&(lixos.splice(i,1),score++,20==score&&end())})})}function checkPlayerBounds(){cestos.forEach(function(_cesto){_cesto.pos[0]-_cesto.left<0?_cesto.pos[0]=0+_cesto.left:_cesto.pos[0]>canvas.width-5*_cesto.sprite.size[0]+_cesto.left&&(_cesto.pos[0]=canvas.width-5*_cesto.sprite.size[0]+_cesto.left)})}function render(){ctx.clearRect(0,0,canvas.width,canvas.height),ctx.drawImage(bg,0,0,canvas.width,canvas.height),renderEntities(lixos),renderEntities(cestos),lifeSprite.render(ctx);var fontSize=30*_x;ctx.fillStyle="#fff",ctx.font=fontSize+"px arial",ctx.fillText(10>score?"0"+score:score,685*_x,53*_x)}function renderEntities(list){list.forEach(function(entity){renderEntity(entity)})}function renderEntity(entity){ctx.save(),ctx.translate(entity.pos[0],entity.pos[1]),entity.sprite.render(ctx),ctx.restore()}function end(){$("#end-screen").fadeIn(),isGameOver=!0}function gameOver(){$("#gameover-screen").fadeIn(),isGameOver=!0,lifes=""}function reset(){isGameOver=!1,gameTime=0,score=0,lifes=6,lixos=[]}window._x=getScale();var requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(cb){window.setTimeout(cb,1e3/60)}}(),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");canvas.width=788*_x,canvas.height=385*_x,document.querySelector("#conteudo").appendChild(canvas);var mouse={x:0,y:0};document.addEventListener("mousemove",function(e){var $principal=$("#principal");mouse.x=e.clientX-$principal.offset().left||e.pageX-$principal.offset().left,mouse.y=e.clientY||e.pageY},!1);var lastTime,bg=new Image;bg.style.width=canvas.width,bg.style.height=canvas.height,bg.src="../img/fotos/12/bg.svg";var lixoSprite=new Image;lixoSprite.src="../img/fotos/12/lixos-sprite.svg";var lixosPreset=[{type:"vidro",sprite:new Sprite(lixoSprite,[0,0],[50*_x,50*_x],0,[0],null,null,!0)},{type:"pilhas",sprite:new Sprite(lixoSprite,[50,0],[50*_x,50*_x],0,[0],null,null,!0)},{type:"papel",sprite:new Sprite(lixoSprite,[100,0],[50*_x,50*_x],0,[0],null,null,!0)},{type:"papel",sprite:new Sprite(lixoSprite,[150,0],[50*_x,50*_x],0,[0],null,null,!0)},{type:"organico",sprite:new Sprite(lixoSprite,[200,0],[50*_x,50*_x],0,[0],null,null,!0)},{type:"papel",sprite:new Sprite(lixoSprite,[250,0],[50*_x,50*_x],0,[0],null,null,!0)},{type:"organico",sprite:new Sprite(lixoSprite,[300,0],[50*_x,50*_x],0,[0],null,null,!0)},{type:"plastico",sprite:new Sprite(lixoSprite,[350,0],[50*_x,50*_x],0,[0],null,null,!0)},{type:"plastico",sprite:new Sprite(lixoSprite,[400,0],[50*_x,50*_x],0,[0],null,null,!0)},{type:"pilhas",sprite:new Sprite(lixoSprite,[450,0],[50*_x,50*_x],0,[0],null,null,!0)},{type:"organico",sprite:new Sprite(lixoSprite,[500,0],[50*_x,50*_x],0,[0],null,null,!0)},{type:"organico",sprite:new Sprite(lixoSprite,[550,0],[50*_x,50*_x],0,[0],null,null,!0)}],cestosSprite=new Image;cestosSprite.src="../img/fotos/12/cestos-sprite.svg";var cestos=[{pos:[255*_x,300*_x],type:"organico",left:0*_x,sprite:new Sprite(cestosSprite,[0,0],[60*_x,60*_x],0,[0],null,null,!0)},{pos:[315*_x,300*_x],type:"papel",left:60*_x,sprite:new Sprite(cestosSprite,[60,0],[60*_x,60*_x],0,[0],null,null,!0)},{pos:[375*_x,300*_x],type:"pilhas",left:120*_x,sprite:new Sprite(cestosSprite,[120,0],[60*_x,60*_x],0,[0],null,null,!0)},{pos:[435*_x,300*_x],type:"plastico",left:180*_x,sprite:new Sprite(cestosSprite,[180,0],[60*_x,60*_x],0,[0],null,null,!0)},{pos:[495*_x,300*_x],type:"vidro",left:240*_x,sprite:new Sprite(cestosSprite,[240,0],[60*_x,60*_x],0,[0],null,null,!0)}],lixos=[],ultimoLixo=Date.now(),gameTime=0,isGameOver=!0,score=0,lifes=6,lifeImg=new Image;lifeImg.src="../img/fotos/12/lifes.svg";var lifeIndex=0,lifeSprite=new Sprite(lifeImg,[lifeIndex,0],[100*_x,100*_x],0,[0],null,null,!0);