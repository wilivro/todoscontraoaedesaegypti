var socket,timeout,player,g_resources=[{name:"desert1",type:"image",src:"data/desert1.png"},{name:"desert",type:"tmx",src:"data/desert.tmx"},{name:"player_male_base",type:"image",src:"data/player_male_base.png"},{name:"fog",type:"image",src:"data/fog.png"}],jsApp={onload:function(){if(!me.video.init("jsapp",500,300,!1,1))return void alert("Sorry but your browser does not support html 5 canvas.");me.audio.init("mp3,ogg"),me.loader.onload=this.loaded.bind(this),me.loader.preload(g_resources),me.state.change(me.state.LOADING),player={id:1,x:0,y:0},me.ObjectSettings.spritewidth=64,me.ObjectSettings.spriteheight=64,me.ObjectSettings.image="player_male_base";var p=new Character(player.x,player.y,me.ObjectSettings);p.z=3,me.game.add(p),me.game.sort()},loaded:function(){me.state.set(me.state.PLAY,new PlayScreen),me.entityPool.add("mainPlayer",PlayerEntity),me.input.bindKey(me.input.KEY.LEFT,"left"),me.input.bindKey(me.input.KEY.RIGHT,"right"),me.input.bindKey(me.input.KEY.UP,"up"),me.input.bindKey(me.input.KEY.DOWN,"down"),me.state.change(me.state.PLAY)}},PlayScreen=me.ScreenObject.extend({onResetEvent:function(){me.levelDirector.loadLevel("desert")},onDestroyEvent:function(){}}),Character=me.ObjectEntity.extend({init:function(x,y,settings){this.parent(x,y,settings),this.setVelocity(2.5,2.5),this.setFriction(.2,.2),this.updateColRect(20,24,44,16),this.gravity=0,this.firstUpdates=2,this.direction="down",this.destinationX=x,this.destinationY=y,this.addAnimation("stand-down",[0]),this.addAnimation("stand-left",[7]),this.addAnimation("stand-up",[14]),this.addAnimation("stand-right",[21]),this.addAnimation("down",[1,2,3,4,5,6]),this.addAnimation("left",[8,9,10,11,12,13]),this.addAnimation("up",[15,16,17,18,19,20]),this.addAnimation("right",[22,23,24,25,26,27])},update:function(){return hadSpeed=0!==this.vel.y||0!==this.vel.x,this.handleInput(),updated=this.updateMovement(),0===this.vel.y&&0===this.vel.x&&(this.setCurrentAnimation("stand-"+this.direction),hadSpeed&&(updated=!0)),updated&&this.parent(this),updated},handleInput:function(){this.destinationX<this.pos.x-10?(this.vel.x-=this.accel.x*me.timer.tick,this.setCurrentAnimation("left"),this.direction="left"):this.destinationX>this.pos.x+10&&(this.vel.x+=this.accel.x*me.timer.tick,this.setCurrentAnimation("right"),this.direction="right"),this.destinationY<this.pos.y-10?(this.vel.y=-this.accel.y*me.timer.tick,this.setCurrentAnimation("up"),this.direction="up"):this.destinationY>this.pos.y+10&&(this.vel.y=this.accel.y*me.timer.tick,this.setCurrentAnimation("down"),this.direction="down")}}),PlayerEntity=Character.extend({init:function(x,y,settings){this.parent(x,y,settings),me.game.viewport.follow(this.pos,me.game.viewport.AXIS.BOTH)},handleInput:function(){me.input.isKeyPressed("left")?(this.vel.x-=this.accel.x*me.timer.tick,this.setCurrentAnimation("left"),this.direction="left"):me.input.isKeyPressed("right")&&(this.vel.x+=this.accel.x*me.timer.tick,this.setCurrentAnimation("right"),this.direction="right"),me.input.isKeyPressed("up")?(this.vel.y=-this.accel.y*me.timer.tick,this.setCurrentAnimation("up"),this.direction="up"):me.input.isKeyPressed("down")&&(this.vel.y=this.accel.y*me.timer.tick,this.setCurrentAnimation("down"),this.direction="down")}});window.onReady(function(){jsApp.onload()});